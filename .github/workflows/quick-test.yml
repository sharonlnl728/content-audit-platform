name: Quick Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch: # Allow manual trigger

jobs:
  quick-check:
    name: Quick Code Check
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json
          
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Install frontend dependencies
        working-directory: ./frontend
        run: npm ci
        
      - name: Install AI service dependencies
        working-directory: ./ai-service
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Frontend syntax check
        working-directory: ./frontend
        run: |
          echo "üîç Checking frontend syntax..."
          npm run build --silent
          echo "‚úÖ Frontend build successful"
          
      - name: Python syntax check
        working-directory: ./ai-service
        run: |
          echo "üîç Checking Python syntax..."
          python -m py_compile main.py
          python -m py_compile config.py
          echo "‚úÖ Python syntax check passed"
          
      - name: Docker build test
        run: |
          echo "üîç Testing Docker builds..."
          docker build -t test-frontend ./frontend
          docker build -t test-ai-service ./ai-service
          echo "‚úÖ Docker builds successful"
          
      - name: Cleanup test images
        if: always()
        run: |
          docker rmi test-frontend test-ai-service || true
          
      - name: Success notification
        run: |
          echo "üéâ Quick test completed successfully!"
          echo "‚úÖ Frontend: Build passed"
          echo "‚úÖ Python: Syntax check passed"
          echo "‚úÖ Docker: Build test passed"
